<!DOCTYPE html>

<html lang="en" xmlns:th="https://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Store</title>
</head>
<body>
<div style="text-align: center;  height: 100%">
    <div style="width: 100%; height: 10vh; background-color: lavender"><h2>Some shop</h2></div>
    <div style="width: 100%; height: 5vh; text-align: right; font-size: 1.5em">
         <span style="margin-right: 5%;">
            <a th:href="@{/}" style="text-decoration: none">log out</a>
        </span>
    </div>
    <div style="float: left; background-color: cadetblue; width: 30%;">
        <table style="border-spacing: 1em">
            <tr>
                <td><a th:href="@{/mainAdmin/{userId}(userId=${userId})}">Products</a></td>
            </tr>
            <tr>
                <td><a th:href="@{/categories/{userId}(userId=${userId})}">Categories</a></td>
            </tr>
            <tr>
                <td><a th:href="@{/orders/{userId}(userId=${userId})}">Orders</a></td>
            </tr>
            <tr>
                <td><a th:href="@{/users/{userId}(userId=${userId})}">Users</a></td>
            </tr>
        </table>
    </div>
    <div style="float: right; width: 70%">
        <form th:action="@{/users/newUser/{userId}(userId=${userId})}" th:object="${user}" method="post"
              onsubmit="return check()">
            <fieldset>
                <legend th:if="${user.id == null}">add user</legend>
                <legend th:unless="${user.id == null}">edit user</legend>
                <br>
                <table>
                    <tr>
                        <td></td>
                        <td><span id="error_name"></span></td>
                    </tr>
                    <tr>
                        <td><label>First name:</label></td>
                        <td><input th:if="${user.id == null}" type="text" th:field="*{firstName}" id="name"
                                   onkeyup="resetErrorName()"></td>
                        <td><input th:unless="${user.id == null}" readonly type="text" th:field="*{firstName}"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><span id="error_lastName"></span></td>
                    </tr>
                    <tr>
                        <td><label>Last name:</label></td>
                        <td><input th:if="${user.id == null}" type="text" th:field="*{lastName}" id="lastName"
                                   onkeyup="resetErrorLastName()"></td>
                        <td><input th:unless="${user.id == null}" readonly type="text" th:field="*{lastName}"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><span id="error_email"></span></td>
                    </tr>
                    <tr>
                        <td><label>Email:</label></td>
                        <td><input th:if="${user.id == null}" type="email" th:field="*{email}" id="email"
                                   onkeyup="resetErrorEmail()"></td>
                        <td><input th:unless="${user.id == null}" readonly type="email" th:field="*{email}"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><span id="error_pass"></span></td>
                    </tr>
                    <tr th:if="${user.id == null}">
                        <td><label>Password:</label></td>
                        <td><input type="password" th:field="*{password}" id="password" onkeyup="resetErrorPass()"></td>
                    </tr>
                    <tr>
                        <td><label>Role:</label></td>
                        <td><select th:if="${user.id == null}" th:field="*{admin}">
                            <option th:value="${true}" selected>Admin</option>
                        </select></td>
                        <td><select th:unless="${user.id == null}" th:field="*{admin}">
                            <option th:value="${false}">Customer</option>
                            <option th:value="${true}">Admin</option>
                        </select></td>
                    </tr>
                    <tr style="text-align: center;">
                        <td><input th:if="${user.id == null}" type="submit" value="Add"></td>
                        <td><input th:unless="${user.id == null}" type="submit" value="Edit"></td>
                    </tr>
                </table>
                <input type="hidden" th:field="*{id}" th:value="${user.id}">
                <input th:unless="${user.id == null}" type="hidden" th:field="*{password}" th:value="${user.password}">
            </fieldset>
        </form>
    </div>
</div>
<script>
    function check() {
        let ok = true;
        let regExp = /[a-zA-Z0-9-_.]{3,}@[a-z]{3,}\.[a-z]{3,}/;
        if (!regExp.test(document.getElementById("email").value)) {
            ok = false;
            let email = document.getElementById("error_email");
            email.innerHTML = "Please enter valid email";
            email.style.color = "red";
        }
        regExp = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{6,}$/;
        if (!regExp.test(document.getElementById("password").value)) {
            ok = false;
            let pass = document.getElementById("error_pass");
            pass.innerHTML = "Please enter valid password";
            pass.style.color = "red";
        }
        regExp = /\b([A-Z][a-z]+)/;
        if (!regExp.test(document.getElementById("name").value)) {
            ok = false;
            let name = document.getElementById("error_name");
            name.innerHTML = "Please enter valid name";
            name.style.color = "red";
        }
        if (!regExp.test(document.getElementById("lastName").value)) {
            ok = false;
            let lName = document.getElementById("error_lastName");
            lName.innerHTML = "Please enter valid last name";
            lName.style.color = "red";
        }

        return ok;
    }

    function resetErrorEmail() {
        document.getElementById("error_email").innerHTML = "";
    }

    function resetErrorPass() {
        document.getElementById("error_pass").innerHTML = "";
    }

    function resetErrorName() {
        document.getElementById("error_name").innerHTML = "";
    }

    function resetErrorLastName() {
        document.getElementById("error_lastName").innerHTML = "";
    }
</script>
</body>
</html>
